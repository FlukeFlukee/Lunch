<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üç± ‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á‡∏ô‡∏µ‡πâ‡∏Å‡∏¥‡∏ô‡πÑ‡∏£‡∏î‡∏µ ü´è</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 text-gray-800">
<div class="max-w-5xl mx-auto p-6">

  <h1 class="text-3xl font-bold text-pink-600 mb-4">üç± ‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á‡∏ô‡∏µ‡πâ‡∏Å‡∏¥‡∏ô‡πÑ‡∏£‡∏î‡∏µ ü´è</h1>

  <!-- ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏Ñ‡∏£‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏±‡πà‡∏á -->
  <div id="todayOrderBox" class="mb-6 bg-white rounded-xl shadow p-6 text-center"></div>

  <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏á‡∏¥‡∏ô -->
  <form id="mainForm" class="space-y-6 bg-white/90 backdrop-blur shadow-xl p-6 rounded-2xl">

    <div>
      <h2 class="text-lg font-semibold mb-2">üë• ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h2>
      <div id="userBlocks" class="space-y-4"></div>
      <button type="button" onclick="addUserBlock()"
        class="bg-red-700 text-white px-4 py-2 rounded-lg hover:bg-red-800">
        ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á
      </button>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
      <div>
        <label class="block font-medium">üí∏ ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î (‡∏ö‡∏≤‡∏ó)</label>
        <input type="number" id="discount" class="w-full mt-1 p-2 border rounded" value="0"/>
      </div>
      <div>
        <label class="block font-medium">üöö ‡∏Ñ‡πà‡∏≤‡∏à‡∏±‡∏î‡∏™‡πà‡∏á (‡∏ö‡∏≤‡∏ó)</label>
        <input type="number" id="delivery" class="w-full mt-1 p-2 border rounded" value="0"/>
      </div>
    </div>

    <div class="pt-4 space-x-2">
      <button type="submit"
        class="bg-pink-600 text-white px-4 py-2 rounded hover:bg-pink-700">
        ü´è ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì
      </button>
      <button type="button" onclick="clearData()"
        class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">
        üßπ ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
      </button>
    </div>
  </form>

  <!-- ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î -->
  <div id="resultSection" class="mt-8"></div>

  <!-- ‡∏õ‡∏è‡∏¥‡∏ò‡∏¥‡∏ô -->
  <div class="mt-6">
    <button onclick="toggleCalendar()"
      class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
      üìÖ ‡πÅ‡∏™‡∏î‡∏á / ‡∏ã‡πà‡∏≠‡∏ô ‡∏õ‡∏è‡∏¥‡∏ò‡∏¥‡∏ô‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£
    </button>
    <div id="calendarSection" class="mt-4 hidden"></div>
  </div>

</div>

<script>
/* =========================
   ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
========================= */
const defaultUsers = [
  "‡∏û‡∏µ‡πà‡∏ü‡∏•‡∏∏‡πä‡∏Ñ","‡∏û‡∏µ‡πà‡∏ã‡∏¥‡∏ô","‡∏û‡∏µ‡πà‡∏ï‡∏±‡πä‡∏Å","‡∏û‡∏µ‡πà‡πÇ‡∏£‡∏™","‡∏û‡∏µ‡πà‡πÅ‡∏ö‡∏á‡∏Ñ‡πå",
  "‡∏ô‡πâ‡∏≠‡∏á‡πÄ‡∏Ñ‡∏ô","‡πÑ‡∏≠‡πà‡∏Ç‡∏ß‡∏±‡∏ç","‡∏ô‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏¢","‡∏û‡∏µ‡πà‡∏Å‡∏¥‡πä‡∏ü","‡∏û‡∏µ‡πà‡∏ï‡∏¥‡πä‡∏Å"
];

const orderPersons = [
  "‡∏ô‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏¢","‡∏ô‡πâ‡∏≠‡∏á‡∏ã‡∏¥‡∏ô","‡∏û‡∏µ‡πà‡∏ü‡∏•‡∏∏‡πä‡∏Ñ",
  "‡∏û‡∏µ‡πà‡πÇ‡∏£‡∏™","‡πÑ‡∏≠‡πà‡∏Ç‡∏ß‡∏±‡∏ç","‡∏û‡∏µ‡πà‡πÅ‡∏ö‡∏á‡∏Ñ‡πå"
];

/* =========================
   ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏á‡∏¥‡∏ô
========================= */
function createMenuRow() {
  const div = document.createElement("div");
  div.className = "grid grid-cols-1 sm:grid-cols-2 gap-4";
  div.innerHTML = `
    <input type="text" placeholder="üçõ ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π" class="food-name p-2 border rounded" />
    <input type="number" step="0.01" placeholder="üí∞ ‡∏£‡∏≤‡∏Ñ‡∏≤" class="food-price p-2 border rounded" />
  `;
  return div;
}

function addUserBlock(name = "") {
  const userDiv = document.createElement("div");
  userDiv.className = "bg-gray-50 p-4 rounded-lg shadow";
  userDiv.innerHTML = `
    <div class="mb-2 flex gap-2">
      <label class="font-semibold">üë§ ‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á:</label>
      <input type="text" class="username p-2 border rounded w-60" value="${name}" />
    </div>
    <div class="menu-list space-y-2 mb-2"></div>
    <button type="button" onclick="addMenuToUser(this)"
      class="bg-blue-500 text-white px-3 py-1 rounded">
      ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π
    </button>
  `;
  userBlocks.appendChild(userDiv);
  userDiv.querySelector(".menu-list").appendChild(createMenuRow());
}

function addMenuToUser(btn) {
  btn.parentElement.querySelector(".menu-list").appendChild(createMenuRow());
}

function clearData() {
  userBlocks.innerHTML = "";
  resultSection.innerHTML = "";
  defaultUsers.forEach(addUserBlock);
}

/* =========================
   Submit
========================= */
mainForm.addEventListener("submit", e => {
  e.preventDefault();

  const discount = +document.getElementById("discount").value || 0;
  const delivery = +document.getElementById("delivery").value || 0;

  const orders = [];
  document.querySelectorAll("#userBlocks > div").forEach(block => {
    const user = block.querySelector(".username").value || "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠";
    block.querySelectorAll(".food-price").forEach((p,i) => {
      const price = +p.value;
      if (!isNaN(price)) {
        const name = block.querySelectorAll(".food-name")[i].value || "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏";
        orders.push({user, name, price});
      }
    });
  });

  if (!orders.length) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡πÄ‡∏°‡∏ô‡∏π");

  const totalFood = orders.reduce((s,o)=>s+o.price,0);
  const total = totalFood - discount + delivery;

  const map = {};
  orders.forEach(o=>{
    map[o.user] ??= {sum:0, list:[]};
    map[o.user].sum += o.price;
    map[o.user].list.push(`${o.name} (${o.price.toFixed(2)})`);
  });

  resultSection.innerHTML = `
    <div class="bg-white p-6 rounded-xl shadow">
      <h2 class="text-xl font-bold text-pink-600 mb-4">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</h2>
      <table class="w-full text-sm border text-center">
        <thead class="bg-pink-100">
          <tr><th>‡∏ä‡∏∑‡πà‡∏≠</th><th>‡πÄ‡∏°‡∏ô‡∏π</th><th>‡∏à‡πà‡∏≤‡∏¢</th></tr>
        </thead>
        <tbody>
          ${Object.entries(map).map(([n,v])=>`
            <tr class="border-t">
              <td>${n}</td>
              <td class="text-left">${v.list.join("<br>")}</td>
              <td class="font-bold text-pink-700">
                ${(v.sum/totalFood*total).toFixed(2)}
              </td>
            </tr>`).join("")}
        </tbody>
      </table>
      <p class="text-right mt-4 font-bold">ü´è ‡∏£‡∏ß‡∏° ${total.toFixed(2)} ‡∏ö‡∏≤‡∏ó</p>
    </div>
  `;
});

/* =========================
   ‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£ (‡∏à.-‡∏®.)
========================= */
function shuffle(arr){
  const a=[...arr];
  for(let i=a.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}

function generateCalendar(start,end){
  const cal={}, people=shuffle(orderPersons);
  let idx=0;

  for(let d=new Date(start); d<=end; d.setDate(d.getDate()+1)){
    const day=d.getDay();
    if(day===0 || day===6) continue; // ‡∏Ç‡πâ‡∏≤‡∏° ‡∏™-‡∏≠‡∏≤

    if(idx>=people.length){
      idx=0;
      people.splice(0,people.length,...shuffle(orderPersons));
    }

    cal[d.toISOString().split("T")[0]] = people[idx++];
  }
  return cal;
}

const calendarData = generateCalendar(
  new Date("2026-01-01"),
  new Date("2030-12-31")
);

/* ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏Ñ‡∏£‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏±‡πà‡∏á */
(function showToday(){
  const today = new Date();
  const key = today.toISOString().split("T")[0];
  const who = calendarData[key] || "‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏±‡πà‡∏á (‡πÄ‡∏™‡∏≤‡∏£‡πå/‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå)";
  todayOrderBox.innerHTML = `
    <h2 class="text-2xl font-bold text-green-600">üç± ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h2>
    <p class="text-3xl mt-4 font-bold">${who}</p>
    <p class="mt-2 text-gray-500">${key}</p>
  `;
})();

/* ‡∏õ‡∏è‡∏¥‡∏ò‡∏¥‡∏ô */
function toggleCalendar(){
  calendarSection.classList.toggle("hidden");
  if(calendarSection.innerHTML) return;

  calendarSection.innerHTML = `
    <div class="bg-white p-6 rounded-xl shadow">
      <h2 class="text-xl font-bold text-blue-600 mb-4">üìÖ ‡∏õ‡∏è‡∏¥‡∏ò‡∏¥‡∏ô‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£ (‡∏à.-‡∏®.)</h2>
      <div class="max-h-[500px] overflow-y-auto">
        <table class="w-full text-sm border">
          ${Object.entries(calendarData).map(([d,p])=>`
            <tr class="border-t">
              <td class="p-2">${d}</td>
              <td class="p-2 font-semibold text-blue-700">${p}</td>
            </tr>`).join("")}
        </table>
      </div>
    </div>
  `;
}

/* ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô */
clearData();
</script>
</body>
</html>
